@* vovkor *@
@*  @model IEnumerable<virdbApp2.Models.maindb> *@
@model PagedList.IPagedList<virdbApp2.Models.maindb>
@using PagedList.Mvc;
@using Microsoft.AspNet.Identity;

@{
    ViewBag.Title = @Resources.Resource.AccessionList;
}

<h3>@Resources.Resource.AccessionList</h3>


@using (Html.BeginForm("Index", "maindb", FormMethod.Get))
{

    <div class="form-group">
        <div class="row">
            <div class="col-md-2">
                @Html.DropDownList("searchField1", null, htmlAttributes: new { @class = "form-control" })
            </div>
            <div class="col-md-3">
                @Html.TextBox("searchStr1", ViewBag.searchStr1 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
            <div class="col-md-1" align="right">ИЛИ</div>
            <div class="col-md-2">
                @Html.TextBox("searchStrOr1", ViewBag.searchStrOr1 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
            <div class="col-md-1" align="right">ИЛИ</div>
            <div class="col-md-2">
                @Html.TextBox("searchStrOr11", ViewBag.searchStrOr11 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
        </div>

        <div class="row" id="hiddenSearch2">
            <div class="col-md-2">
                @Html.DropDownList("searchField2", null, htmlAttributes: new { @class = "form-control" })
            </div>
            <div class="col-md-3">
                @Html.TextBox("searchStr2", ViewBag.searchStr2 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
            <div class="col-md-1" align="right">ИЛИ</div>
            <div class="col-md-2">
                @Html.TextBox("searchStrOr2", ViewBag.searchStrOr2 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
            <div class="col-md-1" align="right">ИЛИ</div>
            <div class="col-md-2">
                @Html.TextBox("searchStrOr22", ViewBag.searchStrOr22 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
        </div>

        <div class="row" id="hiddenSearch3">
            <div class="col-md-2">
                @Html.DropDownList("searchField3", null, htmlAttributes: new { @class = "form-control" })
            </div>
            <div class="col-md-3">
                @Html.TextBox("searchStr3", ViewBag.searchStr3 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
            <div class="col-md-1" align="right">ИЛИ</div>
            <div class="col-md-2">
                @Html.TextBox("searchStrOr3", ViewBag.searchStrOr3 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
            <div class="col-md-1" align="right">ИЛИ</div>
            <div class="col-md-2">
                @Html.TextBox("searchStrOr33", ViewBag.searchStrOr33 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
        </div>

        <div class="row" id="hiddenSearch4">
            <div class="col-md-2">
                @Html.DropDownList("searchField4", null, htmlAttributes: new { @class = "form-control" })
            </div>
            <div class="col-md-3">
                @Html.TextBox("searchStr4", ViewBag.searchSt4 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
            <div class="col-md-1" align="right">ИЛИ</div>
            <div class="col-md-2">
                @Html.TextBox("searchStrOr4", ViewBag.searchStrOr4 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
            <div class="col-md-1" align="right">ИЛИ</div>
            <div class="col-md-2">
                @Html.TextBox("searchStrOr44", ViewBag.searchStrOr44 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
        </div>
        <div class="row" id="hiddenSearch5">
            <div class="col-md-2">
                @Html.DropDownList("searchField5", null, htmlAttributes: new { @class = "form-control" })
            </div>
            <div class="col-md-3">
                @Html.TextBox("searchStr5", ViewBag.searchStr5 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
            <div class="col-md-1" align="right">ИЛИ</div>
            <div class="col-md-2">
                @Html.TextBox("searchStrOr5", ViewBag.searchStrOr5 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
            <div class="col-md-1" align="right">ИЛИ</div>
            <div class="col-md-2">
                @Html.TextBox("searchStrOr55", ViewBag.searchStrOr55 as string, htmlAttributes: new { @class = "form-control", placeholder = "" })
            </div>
        </div>
        <div class="row">       </div>
        <br />

        @*Новая запись*@
        <div class="row">
            <div class="col-md-2">
                @if (User.Identity.GetUserName() != "")
                {
                    @Html.ActionLink(@Resources.Resource.CreateNew, "Create")
                }
            </div>
            <div class="col-md-3">
                @Html.DropDownList("genusChoice", null, htmlAttributes: new { @class = "form-control", placeholder = "Род" })
            </div>
            <div class="col-md-1">
            </div>
            <div class="col-md-2">
                @Html.TextBox("SearchString", ViewBag.CurrentFilter as string, htmlAttributes: new { @class = "form-control", placeholder = @Resources.Resource.Search })
            </div>
            <div class="col-md-1">
                <input type="submit" value=@Resources.Resource.SearchNow class="btn btn-default" />
            </div>
            <div class="col-md-3">
                @Html.Label(@Resources.Resource.CountRecords) @Html.Display("countRecords")
            </div>
        </div>
    </div>
    <br />
}



<table class="table">
    <tr>
        <th>
            @*  @Html.DisplayNameFor(model => model.accenumb) *@
            @Html.ActionLink(@Resources.Resource.accenumb, "Index", new { sortOrder = ViewBag.AccenumbSortParm, currentFilter = ViewBag.CurrentFilter })
        </th>
        <th>
            @Html.ActionLink(@Resources.Resource.NameEng, "Index", new { sortOrder = ViewBag.NameSortParm, currentFilter = ViewBag.CurrentFilter })
        </th>
        <th>
            @* @Html.DisplayNameFor(model => model.accename_rus) *@ 
            @Html.ActionLink(@Resources.Resource.NameRus, "Index", new { sortOrder = ViewBag.NameRusSortParm, currentFilter = ViewBag.CurrentFilter })
        </th>
        <th>
            
            @Html.ActionLink(@Resources.Resource.Crop, "Index", new { sortOrder = ViewBag.CropSortParm, currentFilter = ViewBag.CurrentFilter }) 
        </th>
        <th>
            @Resources.Resource.Taxonomy
        </th>
        <th>
            @Html.ActionLink(@Resources.Resource.AcqDate, "Index", new { sortOrder = ViewBag.DateSortParm, currentFilter = ViewBag.CurrentFilter })
        </th>
 @*     <th>
    @Html.ActionLink("Lat | Long", "Index", new { sortOrder = ViewBag.CoordSortParm, currentFilter = ViewBag.CurrentFilter })
    </th>

    <th>
    @Html.ActionLink("Lat|Long", "Index", new { sortOrder = ViewBag.CoordSortParm, currentFilter = ViewBag.CurrentFilter })
    </th>
*@       
    
        <th width="80px"></th>
    
        
    </tr>

@foreach (var item in Model) {
    <tr>
        <td>
            @Html.DisplayFor(modelItem => item.accenumb)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.accename_eng)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.accename_rus)
        </td>
        <td>
            @Html.DisplayFor(modelItem => item.botanic.taxonomy_crop.crop_name_eng)
        </td>
        <td>
            <!-- можно проваливаться -->
            @Html.DisplayFor(modelItem => item.botanic.taxonomy_genus.taxonomy_family.family_name_calc)
            @Html.DisplayFor(modelItem => item.botanic.taxonomy_genus.genus_name_calc)
            @Html.DisplayFor(modelItem => item.botanic.species_calc)
        </td>

        <td>
            @Html.DisplayFor(modelItem => item.GetAcqDate)
        </td>
        @*<td>
    @Html.DisplayFor(modelItem => item.latitude)  @Html.DisplayFor(modelItem => item.longitude)
    </td>
    <td>
    @Html.DisplayFor(modelItem => item.LatLong_calc)
    </td>
        *@

        <!-- 19.02.2015 VAV -->
        @if (User.Identity.GetUserName().Trim().ToUpper() == item.owner_str.Trim().ToUpper())
        {
            <td>   
@*
    @Html.ActionLink("Edit", "Edit", new { id=item.id }) |
    @Html.ActionLink("Details", "Details", new { id=item.id }) |
    @Html.ActionLink("Delete", "Delete", new { id = item.id })
*@
                @Html.Raw(@Html.ActionLink("[replacetext]", "Edit", new { id = item.id }, new { Class = "action edit", title = @Resources.Resource.Edit }).ToHtmlString().Replace("[replacetext]", "<img src=\"/virdb/Images/edit.png\" />"))
                @Html.Raw(@Html.ActionLink("[replacetext]", "Delete", new { id = item.id }, new { Class = "action del", title = @Resources.Resource.Delete }).ToHtmlString().Replace("[replacetext]", "<img src=\"/virdb/Images/trash.png\" />"))
                
            </td>
        }
        else
        {
            <td>
                @* @Html.ActionLink("Details", "Details", new { id = item.id }) *@
                @Html.Raw(@Html.ActionLink("[replacetext]", "Details", new { id = item.id }, new { Class = "action details", title = @Resources.Resource.Details }).ToHtmlString().Replace("[replacetext]", "<img src=\"/virdb/Images/details.png\" />"))
            </td>
        }

    </tr>
}

</table>
<br />
Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount

@Html.PagedListPager(Model, page => Url.Action("Index",
    new { page, sortOrder = ViewBag.CurrentSort, currentFilter = ViewBag.CurrentFilter }))


@section scripts {
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    @* vovkor подключаем jquery
    <script src="~/Scripts/jquery-1.10.2.min.js" type="text/javascript"></script>
    <script src="~/Scripts/jquery-ui-1.11.4.min.js" type="text/javascript"></script>
    *@

    <section class="scripts">
        <script type="text/javascript">
                    "use strict";
                    // скрыть/показать поля поиска
                    $(function () {
                        // скрывает при загрузке
                        /*
                        $('#hiddenSearch2').hide().click(function (e) {
                            // Метод объекта event stopPropagation останавливает "всплытие" вызова события к родительским элементам
                            // Зачем?
                            e.stopPropagation();
                        });
                        */
                        if (!($('#searchStr2').val())) // если пусто
                        {
                            $('#hiddenSearch2').hide(); // скрываем div
                        }
                        if (!($('#searchStr3').val())) // если пусто
                        {
                            $('#hiddenSearch3').hide(); // скрываем div
                        }
                        if (!($('#searchStr4').val())) // если пусто
                        {
                            $('#hiddenSearch4').hide(); // скрываем div
                        }
                        if (!($('#searchStr5').val())) // если пусто
                        {
                            $('#hiddenSearch5').hide(); // скрываем div
                        }

                         //$('#hiddenSearch4').fadeOut();
                         //$('#hiddenSearch5').fadeOut();

                    });

                    $(document).ready(function () {

                        $("#searchStr1").change('input', function () {
                            var valueId = $('#searchStr1').val();
                            console.log(valueId);
                            if (valueId) // проверка на пусто
                            {
                                $('#hiddenSearch2').show(1000);
                                console.log('divSearchStr1 is not null');
                            }
                            else {
                               // $('#hiddenSearch2').fadeOut(1000);
                            }
                        });

                        $("#searchStr2").change('input', function () {

                            if ($('#searchStr2').val()) // проверка на пусто
                            {
                                $('#hiddenSearch3').show(1000);
                            }
                            else {
                              //  $('#hiddenSearch3').fadeOut(1000);
                            }
                        });

                        $("#searchStr3").change('input', function () {

                            if ($('#searchStr3').val()) // проверка на пусто
                            {
                                $('#hiddenSearch4').show(1000);
                            }
                            else {
                               // $('#hiddenSearch4').fadeOut(1000);
                            }
                        });

                        $("#searchStr4").change('input', function () {

                            if ($('#searchStr4').val()) // проверка на пусто
                            {
                                $('#hiddenSearch5').show(1000);
                            }
                            else {
                               // $('#hiddenSearch5').fadeOut(1000);
                            }
                        });


                    });

        </script>

    </section>
} 